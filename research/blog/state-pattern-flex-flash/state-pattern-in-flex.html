<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Untitled</title>
    <meta name="author" content="Andy Bulka">

    <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->

</head>

<body>
    <!-- <script src="js/scripts.js"></script> -->

    <h1>State Pattern in Flex</h1>
<p>A tutorial on how to implement the State design pattern in Flex 3.  We are going to have a traffic light move through several states (red, orange, green).  Of course there are other states the traffic light might be in, as well as transitional states (green and orange at the same time), but lets keep things simple!</p>
<p>There are four approaches discussed here.  The first approach (version 1) uses flash for the graphics and flex for the logic.  The second approach (version 2)  uses two additional techniques within flex itself (no flash) to decouple graphics from logic.  My thanks for Carl de Jager for his assistance in talking through these designs with me and helping to code them.</p>
<p><iframe style="border: 1px solid #CCC; border-width: 1px; margin-bottom: 5px; max-width: 100%;" src="//www.slideshare.net/slideshow/embed_code/key/9bRXxnPSo2f7tc" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" width="595" height="485"> </iframe></p>
<div style="margin-bottom: 5px;"><strong> <a title="State Pattern In Flex" href="//www.slideshare.net/tcab22/state-pattern-in-flex" target="_blank">State Pattern In Flex</a> </strong> from <strong><a href="https://www.slideshare.net/tcab22" target="_blank">tcab22</a></strong></div>
<h2>Version 1</h2>

<p><em>The embedded flash object (showing our demo) is unable to run in modern browsers so an animation is playing instead.</em></p>
<h2>State Design Pattern</h2>
<p>I'm not going to go into the intricate details of state design pattern here, but at least here is the basic classic UML</p>
<p><img src="{CCM:BASE_URL}/files/20221232582332stateuml.png" alt="20221232582332stateuml.png" width="393" height="170" /></p>
<p>In our case the states will offer a Display() method and an EmitSound() method.  Each concrete state will impement these differently.  The client code only knows about the 'context' class on the left - it is up to the context class to track which state it is in by holding a reference to a concrete state instance, and switching to a different concrete state instance when the state changes.  Client method calls (in our case Display() and EmitSound()) to the context class (in our case called TrafficLightController) are routed to the concrete state instance that happens to be there at the time, resulting in different behaviour depending on the state.  Thus we do away with messy if then else logic and as a bonus can plug in future extra states easily without recoding any if else statements.</p>
<h2>Implementation Steps</h2>
<p>So what we do in version 1 is to create both a Flex project and a Flash project. We leverage Flash's ability to create nice graphics and animations etc. and leave the logic for the superior Flex environment (actionscript 3, more modern architecture, IDE suited for serious OO programmers etc) to handle.</p>
<p>On the flash side of things we create</p>
<ul>
<li>Traffic light graphics (red, green and orange circles plus a background)</li>
<li>Reify a circle graphic as a symbol named 'light'.  Create 3 instances of this and change the color accordingly.  Name the instances mc_red_light, mc_orange_light and mc_green_light</li>
<li>Create a combined symbol named 'TrafficLight' containing the three lights and a background graphic.</li>
</ul>
<p><img src="{CCM:BASE_URL}/files/46631232581071stateinflexvers1flash01.png" alt="46631232581071stateinflexvers1flash01.png" width="639" height="780" /></p>
<ul>
<li>So that we can refer to the flash symbol from Flex ensure that the TrafficLight symbol in the Library is marked as inheriting from our custom Flex class <strong>com.TrafficLightController</strong> class (which we will create below, and which itself inherits from <strong>mx.flash.UIMovieClip)</strong>.  <em>In Flash, you can right click on the symbol name in the Library pane to open the Linkage Properties dialog box to see this settings.</em></li>
</ul>
<p><img src="{CCM:BASE_URL}/files/31961232581107stateinflexvers1flash02.png" alt="31961232581107stateinflexvers1flash02.png" width="447" height="238" /></p>
<p>We then need to include the flash <strong>trafficlight.swc</strong> as an asset in our flex project so that we can refer to it from our flex code. </p>
<p><img src="{CCM:BASE_URL}/files/14911232581218stateinflexvers1flash03.png" alt="14911232581218stateinflexvers1flash03.png" width="273" height="366" /></p>
<p>Now we switch over to Flex for the rest of the coding process.</p>
<h3>Here is the main flex code</h3>
<p>Fire up the main MXML form and enter the following:</p>
<pre><strong>main.mxml</strong></pre>
<pre><span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">?xml</span> <span style="color: #2040a0;">version=</span><span style="color: #008000;">"1.0"</span> <span style="color: #2040a0;">encoding=</span><span style="color: #008000;">"utf-8"</span><span style="color: #2040a0;">?</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br /><span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:Application</span> <span style="color: #2040a0;">xmlns:mx=</span><span style="color: #008000;">"http://www.adobe.com/2006/mxml"</span> <span style="color: #2040a0;">layout=</span><span style="color: #008000;">"vertical"</span> <span style="color: #2040a0;">xmlns:local=</span><span style="color: #008000;">"*"</span> <span style="color: #2040a0;">creationComplete=</span><span style="color: #008000;">"init()"</span> <span style="color: #2040a0;">width=</span><span style="color: #008000;">"186"</span> <span style="color: #2040a0;">height=</span><span style="color: #008000;">"300"</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />	<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">local:TrafficLight</span> <span style="color: #2040a0;">id=</span><span style="color: #008000;">"trafficLight"</span> <span style="color: #2040a0;">width=</span><span style="color: #008000;">"59"</span> <span style="color: #2040a0;">height=</span><span style="color: #008000;">"138"</span> <span style="color: #2040a0;">/</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />	<br />	<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:HBox</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />		<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:VBox</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />			<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:Button</span> <span style="color: #2040a0;">label=</span><span style="color: #008000;">"show red light"</span> <span style="color: #2040a0;">width=</span><span style="color: #008000;">"100%"</span> <span style="color: #2040a0;">click=</span><span style="color: #008000;">"trafficLight.setState(TrafficLightStates.RED_STATE)"</span><span style="color: #2040a0;">/</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />			<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:Button</span> <span style="color: #2040a0;">label=</span><span style="color: #008000;">"show orange light"</span> <span style="color: #2040a0;">width=</span><span style="color: #008000;">"100%"</span> <span style="color: #2040a0;">click=</span><span style="color: #008000;">"trafficLight.setState(TrafficLightStates.ORANGE_STATE)"</span><span style="color: #2040a0;">/</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />			<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:Button</span> <span style="color: #2040a0;">label=</span><span style="color: #008000;">"show green light"</span> <span style="color: #2040a0;">width=</span><span style="color: #008000;">"100%"</span> <span style="color: #2040a0;">click=</span><span style="color: #008000;">"trafficLight.setState(TrafficLightStates.GREEN_STATE)"</span><span style="color: #2040a0;">/</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />		<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">/mx:VBox</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />	<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">/mx:HBox</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />	<br />	<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">mx:Script</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />		<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">![CDATA[<br /> import</span> <span style="color: #2040a0;">com.TrafficLightStates;<br /> <br /> private</span> <span style="color: #2040a0;">function</span> <span style="color: #2040a0;">init():void<br /> {<br /> trafficLight.setState(TrafficLightStates.RED_STATE);<br /> }<br /><br /> ]]</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />	<span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">/mx:Script</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span><br />	<br /><span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">/mx:Application</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span></pre>
<p>Note that we refer to the flash object with the phrase</p>
<p>          <span style="color: #2040a0;"><strong><span style="color: #4444ff;"><strong>&lt;</strong></span><span style="color: #2040a0;">local:TrafficLight</span> <span style="color: #2040a0;">id=</span><span style="color: #008000;">"trafficLight"</span> <span style="color: #2040a0;">width=</span><span style="color: #008000;">"59"</span> <span style="color: #2040a0;">height=</span><span style="color: #008000;">"138"</span> <span style="color: #2040a0;">/</span><span style="color: #4444ff;"><strong>&gt;</strong></span></strong></span></p>
<h3>Controller code</h3>
<pre><strong>TrafficLightController.as</strong></pre>
<pre>package com<br /><span style="color: #4444ff;"><strong>{</strong></span><br />	import flash.display.MovieClip<span style="color: #4444ff;">;</span><br />	<br />	import mx.flash.UIMovieClip<span style="color: #4444ff;">;</span><br />	<br />	public class TrafficLightController extends UIMovieClip<br />	<span style="color: #4444ff;"><strong>{</strong></span><br />		private <strong>var</strong> _states:<span style="color: #2040a0;"><strong>Array</strong></span> <span style="color: #4444ff;">=</span> <strong>new</strong> <span style="color: #2040a0;"><strong>Array</strong></span>()<span style="color: #4444ff;">;</span><br />		private <strong>var</strong> _state:ITrafficLightState<span style="color: #4444ff;">;</span><br />		<br />		public <strong>function<span style="color: #ff0000;"> TrafficLightController</span><span style="color: #2040a0;">()</span><br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			super()<span style="color: #4444ff;">;</span><br />			<br />			_states <span style="color: #4444ff;">=</span> <strong>new</strong> <span style="color: #2040a0;"><strong>Array</strong></span>()<span style="color: #4444ff;">;</span><br />			_states[TrafficLightStates.RED_STATE] <span style="color: #4444ff;">=</span> <strong>new</strong> RedState(<strong>this</strong>)<span style="color: #4444ff;">;</span><br />			_states[TrafficLightStates.ORANGE_STATE] <span style="color: #4444ff;">=</span> <strong>new</strong> OrangeState(<strong>this</strong>)<span style="color: #4444ff;">;</span><br />			_states[TrafficLightStates.GREEN_STATE] <span style="color: #4444ff;">=</span> <strong>new</strong> GreenState(<strong>this</strong>)<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		<span style="color: #444444;">// ------------------------------------------------</span><br />		<span style="color: #444444;">// COMMANDS</span><br />		<span style="color: #444444;">// ------------------------------------------------</span><br />		<br />		public <strong>function<span style="color: #ff0000;"> setState</span><span style="color: #2040a0;">(name:String)</span>:void<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			_state <span style="color: #4444ff;">=</span> _states[<span style="color: #2040a0;"><strong>name</strong></span>]<span style="color: #4444ff;">;</span><br />			display()<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		public <strong>function<span style="color: #ff0000;"> display</span><span style="color: #2040a0;">()</span>:void<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			switchOffAllLights()<span style="color: #4444ff;">;</span><br />			_state.display()<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		public <strong>function<span style="color: #ff0000;"> emitSound</span><span style="color: #2040a0;">()</span>:void<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			_state.emitSound()<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		internal <strong>function<span style="color: #ff0000;"> switchOffAllLights</span><span style="color: #2040a0;">()</span>:void<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			red_light.visible <span style="color: #4444ff;">=</span> false<span style="color: #4444ff;">;</span><br />			orange_light.visible <span style="color: #4444ff;">=</span> false<span style="color: #4444ff;">;</span><br />			green_light.visible <span style="color: #4444ff;">=</span> false<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<span style="color: #444444;">// ------------------------------------------------</span><br />		<span style="color: #444444;">// QUERIES</span><br />		<span style="color: #444444;">// ------------------------------------------------</span><br />		<br />		internal <strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> red_light</span><span style="color: #2040a0;">()</span>:MovieClip<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			<strong>return</strong> getChildByName(<span style="color: #008000;">"mc_<span style="color: #2040a0;">red</span>_light"</span>) as MovieClip<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		internal <strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> orange_light</span><span style="color: #2040a0;">()</span>:MovieClip<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			<strong>return</strong> getChildByName(<span style="color: #008000;">"mc_<span style="color: #2040a0;">orange</span>_light"</span>) as MovieClip<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		internal <strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> green_light</span><span style="color: #2040a0;">()</span>:MovieClip<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			<strong>return</strong> getChildByName(<span style="color: #008000;">"mc_<span style="color: #2040a0;">green</span>_light"</span>) as MovieClip<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />	<span style="color: #4444ff;"><strong>}</strong></span><br /><span style="color: #4444ff;"><strong>}</strong></span></pre>
<p> </p>
<h3>Traffic Light States</h3>
<pre><strong>TrafficLightStates.as</strong></pre>
<pre>package com<br /><span style="color: #4444ff;"><strong>{</strong></span><br />	public class TrafficLightStates<br /><br />	<span style="color: #4444ff;"><strong>{</strong></span><br />		public static const RED_STATE:String <span style="color: #4444ff;">=</span> <span style="color: #008000;">"RED_STATE"</span><span style="color: #4444ff;">;</span><br />		public static const ORANGE_STATE:String <span style="color: #4444ff;">=</span> <span style="color: #008000;">"ORANGE_STATE"</span><span style="color: #4444ff;">;</span><br />		public static const GREEN_STATE:String <span style="color: #4444ff;">=</span> <span style="color: #008000;">"GREEN_STATE"</span><span style="color: #4444ff;">;</span><br />	<span style="color: #4444ff;"><strong>}</strong></span><br /><span style="color: #4444ff;"><strong>}</strong></span><br /><br /></pre>
<h3>ITrafficLightState interface</h3>
<p>Traffic Light States all follow this interface</p>
<pre><strong>ITrafficLightState.as</strong><br />package com<br /><span style="color: #4444ff;"><strong>{</strong></span><br />	public interface ITrafficLightState<br />	<span style="color: #4444ff;"><strong>{</strong></span><br />		<strong>function<span style="color: #ff0000;"> display</span><span style="color: #2040a0;">()</span>:void;<br /></strong>		<strong>function<span style="color: #ff0000;"> emitSound</span><span style="color: #2040a0;">()</span>:void;<br /></strong>		<br />		<strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> context</span><span style="color: #2040a0;">()</span>:TrafficLightController;<br /></strong>	<span style="color: #4444ff;"><strong>}</strong></span><br /><span style="color: #4444ff;"><strong>}</strong></span><br /><br /></pre>
<h3>Concrete states</h3>
<pre><strong><strong>RedState.as<br /></strong></strong><br />package com<br /><span style="color: #4444ff;"><strong>{</strong></span><br />	public class RedState implements ITrafficLightState<br />	<span style="color: #4444ff;"><strong>{</strong></span><br />		private <strong>var</strong> _context:TrafficLightController<span style="color: #4444ff;">;</span><br />		<br />		public <strong>function<span style="color: #ff0000;"> RedState</span><span style="color: #2040a0;">(context:TrafficLightController)</span><br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			_context <span style="color: #4444ff;">=</span> context<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		public <strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> context</span><span style="color: #2040a0;">()</span>:TrafficLightController<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			<strong>return</strong> _context<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		public <strong>function<span style="color: #ff0000;"> display</span><span style="color: #2040a0;">()</span>:void<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />			context.red_light.visible <span style="color: #4444ff;">=</span> true<span style="color: #4444ff;">;</span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />		<br />		public <strong>function<span style="color: #ff0000;"> emitSound</span><span style="color: #2040a0;">()</span>:void<br /></strong>		<span style="color: #4444ff;"><strong>{</strong></span><br />		<span style="color: #4444ff;"><strong>}</strong></span><br />	<span style="color: #4444ff;"><strong>}</strong></span><br /><span style="color: #4444ff;"><strong>}</strong></span><br /><br /></pre>
<pre><strong>GreenState.as</strong></pre>
<pre>package com<br /><span style="color: #4444ff;"><strong>{</strong></span><br /> public class GreenState implements ITrafficLightState<br /> <span style="color: #4444ff;"><strong>{</strong></span><br /> private <strong>var</strong> _context:TrafficLightController<span style="color: #4444ff;">;</span><br /> <br /> public <strong>function<span style="color: #ff0000;"> GreenState</span><span style="color: #2040a0;">(context:TrafficLightController)</span><br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> _context <span style="color: #4444ff;">=</span> context<span style="color: #4444ff;">;</span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <br /> public <strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> context</span><span style="color: #2040a0;">()</span>:TrafficLightController<br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> <strong>return</strong> _context<span style="color: #4444ff;">;</span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <br /> public <strong>function<span style="color: #ff0000;"> display</span><span style="color: #2040a0;">()</span>:void<br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> context.green_light.visible <span style="color: #4444ff;">=</span> true<span style="color: #4444ff;">;</span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <br /> public <strong>function<span style="color: #ff0000;"> emitSound</span><span style="color: #2040a0;">()</span>:void<br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /><span style="color: #4444ff;"><strong>}</strong></span></pre>
<pre><strong>OrangeState.as</strong></pre>
<pre>package com<br /><span style="color: #4444ff;"><strong>{</strong></span><br /> public class OrangeState implements ITrafficLightState<br /> <span style="color: #4444ff;"><strong>{</strong></span><br /> private <strong>var</strong> _context:TrafficLightController<span style="color: #4444ff;">;</span><br /> <br /> public <strong>function<span style="color: #ff0000;"> OrangeState</span><span style="color: #2040a0;">(context:TrafficLightController)</span><br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> _context <span style="color: #4444ff;">=</span> context<span style="color: #4444ff;">;</span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <br /> public <strong>function<span style="color: #ff0000;"> get</span><span style="color: #ff0000;"> context</span><span style="color: #2040a0;">()</span>:TrafficLightController<br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> <strong>return</strong> _context<span style="color: #4444ff;">;</span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <br /> public <strong>function<span style="color: #ff0000;"> display</span><span style="color: #2040a0;">()</span>:void<br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> context.orange_light.visible <span style="color: #4444ff;">=</span> true<span style="color: #4444ff;">;</span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <br /> public <strong>function<span style="color: #ff0000;"> emitSound</span><span style="color: #2040a0;">()</span>:void<br /></strong> <span style="color: #4444ff;"><strong>{</strong></span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /> <span style="color: #4444ff;"><strong>}</strong></span><br /><span style="color: #4444ff;"><strong>}</strong></span></pre>
<h3>How it works</h3>
<p>The flex code within the concrete state classes ends up setting the visibility of the individual flash graphic components.  Remember the flash graphics are really dumb and have no logic in them.  The flex code refers to the flash graphic symbols with the following technique</p>
<pre><strong>return</strong> getChildByName(<span style="color: #008000;">"mc_<span style="color: #2040a0;">red</span>_light"</span>) as MovieClip<span style="color: #4444ff;">;</span></pre>
<p>which dynamically looks up the graphic and hands it to the flex code which then sets the <strong>.visible</strong> property as needed. Ironically the code that drives the flash color changing lives in the TrafficLightController class, as a bunch of utility methods that the concrete state classes call upon.  Note also that the EmitSound() method is not implemented in this project.</p>
<h2>UML</h2>
<p>Here is the UML of the solution.</p>


<p>Note how the user drives the flex MXML form which holds a reference to the flash object.  See how the flash object inherits from the TrafficLightController class thereby we auto-magically graft on smart behaviour to the dumb flash symbol.</p>
<p>The TrafficLightControllerclass is the 'context' in our State design pattern and holds an instance of a state object.  The states are singletons kept in an array, so that we don't have to keep creating and deleting state instances (this is a common implementation trick when implementing state pattern).</p>
<h2>Version 2</h2>
<p>Just to be bold and learn flex more deeply, here are another three solutions to implementing the traffic light using design state pattern in flash and flex. I have created three different implementations within the one architecture.  We use the following techniques:</p>
<ul>
<li>Accessing a flash component (as before) but now with skinning</li>
<li>Pure Flex solution with the graphics as images assembled purely in MXML, code inside the mxml file</li>
<li>Pure Flex solution, graphics in MXML, code in a separate proper flex class - using a technique known as 'code behind'</li>
</ul>
<p>Here is the resulting flash application - go on and click on the buttons!</p>


<h2>Implementation Steps</h2>
<p>I won't list all the code, however here is the MXML file for the all in one solution version</p>
<pre><span style="color: #4444ff;">&lt;</span>?xml version<span style="color: #4444ff;">=</span><span style="color: #008000;">"1.0"</span> <span style="color: #2040a0;"><strong>encoding</strong></span><span style="color: #4444ff;">=</span><span style="color: #008000;">"utf-8"</span>?<span style="color: #4444ff;">&gt;</span><br /><span style="color: #4444ff;">&lt;</span>mx:Canvas xmlns:mx<span style="color: #4444ff;">=</span><span style="color: #008000;">"http://www.adobe.com/2006/mxml"</span> implements<span style="color: #4444ff;">=</span><span style="color: #008000;">"com.ITrafficLightView"</span> <span style="color: #2040a0;"><strong>width</strong></span><span style="color: #4444ff;">=</span><span style="color: #008000;">"59"</span> <span style="color: #2040a0;"><strong>height</strong></span><span style="color: #4444ff;">=</span><span style="color: #008000;">"138"</span> initialize<span style="color: #4444ff;">=</span><span style="color: #008000;">"init()"</span><span style="color: #4444ff;">&gt;</span><br /><br />	<span style="color: #4444ff;">&lt;</span>mx:<span style="color: #2040a0;"><strong>Image</strong></span> x<span style="color: #4444ff;">=</span><span style="color: #008000;">"0"</span> y<span style="color: #4444ff;">=</span><span style="color: #008000;">"0"</span> source<span style="color: #4444ff;">=</span><span style="color: #008000;">"TrafficLightSkin_box"</span><span style="color: #4444ff;">/</span><span style="color: #4444ff;">&gt;</span><br />	<span style="color: #4444ff;">&lt;</span>mx:<span style="color: #2040a0;"><strong>Image</strong></span> id<span style="color: #4444ff;">=</span><span style="color: #008000;">"<span style="color: #2040a0;">red</span>_light"</span> x<span style="color: #4444ff;">=</span><span style="color: #008000;">"19"</span> y<span style="color: #4444ff;">=</span><span style="color: #008000;">"36"</span> source<span style="color: #4444ff;">=</span><span style="color: #008000;">"TrafficLightSkin_<span style="color: #2040a0;">red</span>_light"</span><span style="color: #4444ff;">/</span><span style="color: #4444ff;">&gt;</span><br />	<span style="color: #4444ff;">&lt;</span>mx:<span style="color: #2040a0;"><strong>Image</strong></span> id<span style="color: #4444ff;">=</span><span style="color: #008000;">"<span style="color: #2040a0;">orange</span>_light"</span> x<span style="color: #4444ff;">=</span><span style="color: #008000;">"19"</span> y<span style="color: #4444ff;">=</span><span style="color: #008000;">"69"</span> source<span style="color: #4444ff;">=</span><span style="color: #008000;">"TrafficLightSkin_<span style="color: #2040a0;">orange</span>_light"</span><span style="color: #4444ff;">/</span><span style="color: #4444ff;">&gt;</span><br />	<span style="color: #4444ff;">&lt;</span>mx:<span style="color: #2040a0;"><strong>Image</strong></span> id<span style="color: #4444ff;">=</span><span style="color: #008000;">"<span style="color: #2040a0;">green</span>_light"</span> x<span style="color: #4444ff;">=</span><span style="color: #008000;">"19"</span> y<span style="color: #4444ff;">=</span><span style="color: #008000;">"103"</span> source<span style="color: #4444ff;">=</span><span style="color: #008000;">"TrafficLightSkin_<span style="color: #2040a0;">green</span>_light"</span><span style="color: #4444ff;">/</span><span style="color: #4444ff;">&gt;</span><br />	<br />	<span style="color: #4444ff;">&lt;</span>mx:Script<span style="color: #4444ff;">&gt;</span><br />		<span style="color: #4444ff;">&lt;</span>![CDATA[<br />			<br />			private <strong>var</strong> _controller:TrafficLightController<span style="color: #4444ff;">;</span><br />			<br />			private <strong>function<span style="color: #ff0000;"> init</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				setController(<strong>new</strong> TrafficLightController(<strong>this</strong>))<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> setController</span><span style="color: #2040a0;">(val:TrafficLightController)</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				_controller <span style="color: #4444ff;">=</span> val<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />	<br />			public <strong>function<span style="color: #ff0000;"> setState</span><span style="color: #2040a0;">(val:String)</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				_controller.setState(val)<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> emitSound</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				_controller.emitSound()<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> display</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				_controller.display()<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> getController</span><span style="color: #2040a0;">()</span>:TrafficLightController<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				<strong>return</strong> null<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> setRed</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				switchOffAllLights()<span style="color: #4444ff;">;</span><br />				red_light.visible <span style="color: #4444ff;">=</span> true<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> setOrange</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				switchOffAllLights()<span style="color: #4444ff;">;</span><br />				orange_light.visible <span style="color: #4444ff;">=</span> true<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			public <strong>function<span style="color: #ff0000;"> setGreen</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				switchOffAllLights()<span style="color: #4444ff;">;</span><br />				green_light.visible <span style="color: #4444ff;">=</span> true<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />			<br />			<span style="color: #444444;">// HELPERS</span><br />			<br />			internal <strong>function<span style="color: #ff0000;"> switchOffAllLights</span><span style="color: #2040a0;">()</span>:void<br /></strong>			<span style="color: #4444ff;"><strong>{</strong></span><br />				red_light.visible <span style="color: #4444ff;">=</span> false<span style="color: #4444ff;">;</span><br />				orange_light.visible <span style="color: #4444ff;">=</span> false<span style="color: #4444ff;">;</span><br />				green_light.visible <span style="color: #4444ff;">=</span> false<span style="color: #4444ff;">;</span><br />			<span style="color: #4444ff;"><strong>}</strong></span><br />		]]<span style="color: #4444ff;">&gt;</span><br />	<span style="color: #4444ff;">&lt;</span><span style="color: #4444ff;">/</span>mx:Script<span style="color: #4444ff;">&gt;</span><br />	<br /><span style="color: #4444ff;">&lt;</span><span style="color: #4444ff;">/</span>mx:Canvas<span style="color: #4444ff;">&gt;</span><br /><br /></pre>
<h3>Here is the UML</h3>

<h3>Why is the above UML so complex?</h3>
<p>Because we are trying to implement three different techniques in the one example, the UML gets complex. In all cases the state design pattern model logic is the same, which is good code reuse.  We use adapters (another design pattern) to accommodate three different implementations within the one architecture, which itself is pretty cool.</p>
<p><img src="{CCM:BASE_URL}/files/52451232585108stateinflexv2flash02.png" alt="52451232585108stateinflexv2flash02.png" width="686" height="406" /></p>
<p>Note that the classes handling the graphics display (red/orange/green lights and associated buttons) are actually fairly lightweight, and indicated in dark yellow.</p>
<p>The complexity is really in the "adapter" classes above them which house the code to implement the ITrafficView interface (allowing for our 3 variant implementations in the one architecture approach) and which allows the graphic classes to remain dumb and small.</p>
<p>The benefit of this approach (besides learning about how to do the same thing in different ways within flex and thereby understanding flex better) is that we can change the graphic implementation at any time without changing our core business logic model, and our state design pattern (which resides in the model) also remains stable.</p>




</body>

</html>